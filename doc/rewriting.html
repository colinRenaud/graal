<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'/>
    <meta name="description" content="Example that shows how rewrite query using Graal"/>
    <meta name="keywords" content="Graal, getting started, rewriting, querying"/>
    <!-- Import Google Icon Font-->
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" media="screen" href="../stylesheets/materialize.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="../stylesheets/stylesheet.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="../stylesheets/table.css"/>
    <link rel="stylesheet" type="text/css" media="screen" href="../stylesheets/hljs-style.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="../js/main.js"></script>
    <title>Query rewriting</title>
  </head>
  <body>
    <!-- HEADER -->
    <div class="navbar-fixed">
  <nav>
    <div class="nav-wrapper">
      <div id="logo-container"><a href="../" class="brand-logo">Graal</a></div>
      <ul class="right hide-on-med-and-down">
        <li class="active"><a href="../doc/index">Documentation</a></li>
        <li class=""><a href="../downloads/index">Apps & Downloads</a></li>
        <li class=""><a href="../publications">Publications</a></li>
        <li><a href="../experiments1">Experiments</a></li>
        <li><a href="https://github.com/graphik-team/graal/">Sources</a></li>
      </ul>
      <ul class="side-nav" id="nav-mobile">
        <li class="active"><a href="../doc/index">Documentation</a></li>
        <li class=""><a href="../downloads/index">Apps & Downloads</a></li>
        <li class=""><a href="../publications">Publications</a></li>
        <li><a href="../experiments1">Experiments</a></li>
        <li><a href="https://github.com/graphik-team/graal/">Sources</a></li>
      </ul>
      <a href="#" data-activates="nav-mobile" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>
  </nav>
</div>
    <!-- BODY -->
    <div class="row">
      <div id="page-menu" class="col s12 m5 l3">
<ul class="collection collapsible">
  <li><a class="collection-item" href="../doc/index">Overview</a></li>
  <li><a class="collection-item" href="../doc/eclipse">Getting Started with Eclipse</a></li>
  <li><a class="collection-item" href="../doc/netbeans">Getting Started with NetBeans</a></li>
  <li><a class="collection-item" href="../doc/without-ide">Getting Started without IDE</a></li>
  <li><a class="collection-item" href="../doc/slf4j">SLF4J Configuration</a></li>
  <li>
    <div class="collapsible-header collection-item">Examples</div>
      <ul class="collapsible-body">
        <li><a class="collection-item" href="../doc/getting-started">Getting started with a KB</a></li>
        <li><a class="collection-item" href="../doc/scenario1">Relational DB querying</a></li>
        <!-- <li><a class="collection-item" href="../"><span class="todo">DBPedia querying</span></a></li>
 -->
        <li><a class="collection-item active" href="../doc/rewriting">Query rewriting</a></li>
        <!-- <li><a class="collection-item" href="../"><span class="todo">SPARQL rewriting</span></a></li>
 -->
        <li><a class="collection-item" href="../doc/owl-parser">OWL parsing</a></li>
        <!-- <li><a class="collection-item" href="../"><span class="todo">RDF parsing</span></a></li>
 -->
        <!-- <li><a class="collection-item" href="../"><span class="todo">Ontology analysis</span></a></li>
 -->
        <!-- <li><a class="collection-item" href="../"><span class="todo">Data exchange</span></a></li>
 -->
      </ul>
  </li>
  <li>
    <div class="collapsible-header collection-item">Technical documentation</div>
      <ul class="collapsible-body">
        <li><a class="collection-item" href="../doc/core-module">Core</a></li>
        <li><a class="collection-item" href="../doc/io-dlgp-module">Dlgp IO</a></li>
        <li><a class="collection-item" href="../doc/homomorphism-module">Homomorphism</a></li>
        <li><a class="collection-item" href="../doc/kb-module">KB</a></li>
        <li><a class="collection-item" href="../doc/chase-module">Forward Chaining</a></li>
        <li><a class="collection-item" href="../doc/backward-chaining-module">Backward Chaining</a></li>
        <li><a class="collection-item" href="../doc/store-module">Store</a></li>
        <li><a class="collection-item" href="../doc/ruleclasses">Rule Set Analyser</a></li>
      </ul>
  </li>
  <li><a class="collection-item" href="../doc/dlgp">DLGP</a></li>
  <li><a class="collection-item" href="../1.3.1/javadocs/">Javadoc</a></li>
</ul>
      </div>
      <div id="page-content" class="col s12 m7 l9">
<h2>Requirements</h2>
<ul>
  <li>This example requires Java 7 or newer.</li>
   <li>Download the following package <a href="..//1.3.1/examples/graal-rewriting-example.zip">graal-rewriting-example.zip</a>
    and extract it where you want.
  </li>
</ul>
<h2>Build</h2>
<p>Open a terminal and go into the extracted folder. Then, execute the following command:</p>
<code>javac -cp rewriting-example-1.3.1.jar fr/lirmm/graphik/graal/examples/rewriting/Rewriting.java</code>
<h2>Run the example</h2>
<p>Execute the following command:</p>
<code>java -cp rewriting-example-1.3.1.jar fr/lirmm/graphik/graal/examples/rewriting/Rewriting ./data/</code>
<h2>What does this example do?</h2>
<ol>
  <li>Create a DLGP writer to display the rewritings:
    <pre><code class="java">
    DlgpWriter writer = new DlgpWriter();
    </code></pre>
  </li>
  <li>Define some prefixes:
    <pre><code class="java">
    writer.write(new Prefix("", "http://ksg.meraka.co.za/adolena.owl#"));
    writer.write(new Prefix("NAP", "file:///home/aurona/0AlleWerk/Navorsing/Ontologies/NAP/NAP#"));
    </code></pre>
  </li>
  <li>Load rules from a DLGP File:
    <pre><code class="java">
    File f = new File(rootDir, "A.dlp");
    Ontology onto = new DefaultOntology(new DlgpParser(f));
    </code></pre>
  </li>
  <li>Create a query from a Java string:
    <pre><code class="java">
    ConjunctiveQuery query = DlgpParser.parseQuery("@prefix : <http://ksg.meraka.co.za/adolena.owl#> "
    		+ "@prefix NAP: &lt;file:///home/aurona/0AlleWerk/Navorsing/Ontologies/NAP/NAP#&gt; "
    		+ "?(X0) :- NAP:Device(X0), :assistsWith(X0, X1).");
    </code></pre>
  </li>
  <li>Print the query:
    <pre><code class="java">
    writer.write("\n= Query =\n");
    writer.write(query);
    </code></pre>
  </li>
  <li>Initialize the rewriter:
    <pre><code class="java">
    QueryRewriter rewriter = new PureRewriter();
    CloseableIteratorWithoutException<ConjunctiveQuery> it = rewriter.execute(query, onto);
    </code></pre>
  </li>
  <li>Rewrite the query and display the rewritings:
    <pre><code class="java">
    writer.write("\n= Rewritings =\n");
    while (it.hasNext()) {
    	writer.write(it.next());
    	writer.flush();
    }
    it.close();
    </code></pre>
  </li>
	<h3> We will now show how compile a part of your ontology to produce
		"pivotal" rewritings according to this compilation. Then, we will
		unfold these pivotal rewritings to obtain classical rewritings (note that pivotal rewritings could also be evaluated without generating classical rewritings).
  </h3>
  <li>Compile a part of the ontology (so-called compilable rules):
    <pre><code class="java">
    RulesCompilation compilation = new IDCompilation();
    compilation.compile(onto.iterator());
    </code></pre>
  </li>
  <li>Initialize the rewriter with unfolding disabled (ie we don't want classical rewritings but rather pivotal rewritings):
    <pre><code class="java">
    PureRewriter pure = new PureRewriter(false);
    </code></pre>
  </li>
  <li>Rewrite the query according to the specified ontology and compilation:
    <pre><code class="java">
    it = pure.execute(query, onto, compilation);
    </code></pre>
  </li>
  <li>Save the (pivotal) rewritings in a UnionOfConjunctiveQueries object:
    <pre><code class="java">
    UnionOfConjunctiveQueries ucq = new DefaultUnionOfConjunctiveQueries(query.getAnswerVariables(), it);
    </code></pre>
  </li>
  <li>Print this (pivotal) UCQ:
    <pre><code class="java">
    writer.write("\n= Pivotal Rewritings =\n");
    writer.write(ucq);
    </code></pre>
  </li>
  <li>Unfold the pivotal rewritings to get classical rewritings:
    <pre><code class="java">
    writer.write("\n= Unfolded Rewritings =\n");
    it = PureRewriter.unfold(ucq, compilation);
    while (it.hasNext()) {
    	writer.write(it.next());
    	writer.flush();
    }
    it.close();
    </code></pre>
  </li>
  <li>Close resources:
    <pre><code class="java">
    writer.close();
    </code></pre>
  </li>
</ol>
      </div>
    </div>
    <!-- FOOTER -->
    <!-- FOOTER -->
    <footer class="page-footer">
      <div class="container">
        <a href="mailto:sympa@lirmm.fr?subject=SUBSCRIBE graal">Subscribe to Graal newsletter</a>
        <p> Contact:
        <script type="text/javascript">
        <!-- //encodage de l'adresse email
                Rot17.write('<r yivw="jlggfik-xirrc@czidd.wi">jlggfik-xirrc@czidd.wi</r>');
                document.write(' ');
        -->
        </script></p>
        <p>
            Thanks to <a href="https://www.yourkit.com"><img style="height: 24px; bottom: -6px; border: none; box-shadow: none; margin: 0; padding: 0;" src="https://www.yourkit.com/images/yklogo.png"></a> for its <a href="https://www.yourkit.com/java/profiler/index.jsp">Java Profiler</a></br>
            Published with <a href="https://pages.github.com">GitHub Pages</a>
        </p>
      </div>
      <div class="footer-copyright">
      <div class="container">
          Graal maintained by <a href="https://team.inria.fr/graphik/">GraphIK team</a>
      </div>
    </div>
    </footer>
    <!-- Import jQuery before materialize.js -->
<script type="text/javascript" src="../js/materialize.min.js"></script>
<!-- Code highlighting -->
<script type="text/javascript" src="../js/highlight.pack.js"></script>
<script type="text/javascript" src="../js/init.js"></script>
<!-- Piwik -->
<script type="text/javascript">
var _paq = _paq || [];
_paq.push(['trackPageView']);
_paq.push(['enableLinkTracking']);
(function() {
var u="//info-demo.lirmm.fr/analytics/";
_paq.push(['setTrackerUrl', u+'piwik.php']);
_paq.push(['setSiteId', 1]);
var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
})();
</script>
<noscript><p><img src="//info-demo.lirmm.fr/analytics/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
  </body>
</html>
